# go-player-api-ephemeral

This repository is intended as an exercise to understand basic API features, as well as gain some proficiency in GoLang by writing a simple player API.

## Objectives

- [x] Implement the API
- [x] Document API using Swagger
- [ ] Implement testing to a reasonable degree of coverage
- [ ] Dockerize the application 

## API Endpoints
|Operation | Endpoint | Returns |
| :---: | :---: | --- |
|`GET` | `/v1/players` | Returns a list of all players in the API. |
|`POST` | `/v1/players` | Create a new player (local storage only).|
|`GET` | `/v1/players/{player_id}` | Returns a player if unique id is matched. |
| `GET` | `/v1/admin` | Returns a basic-auth protected 'Admin Portal' |
---
 

## Using the API

You will need go installed in your machine in order to run the API. Once you have done so, clone the repo and run the API with:
    
    ADMIN_PASSWORD=<your-admin-password> go run server.go
From the main project folder. You will be able to set a password for the `/admin` endpoint with the `ADMIN_PASSWORD` env variable.

Leave the server running and open another terminal.

---

### Get All Players

You can get all the players stored in server local store by running: 

    curl localhost:8080/v1/players

NOTE: this will be an empty response is no players have been created.

---

### Create a Player

Below is a demo on how to create a player using the API server:

    curl localhost:8080/v1/players -X POST -d '{"firstname":"Roger","lastname":"Federer", "sport":"Tennis", "gender":"M","age":39,"country":"Switzerland"}' -H "Content-Type: application/json"

If you forget to include the content-type header, you will be returned a 'Unsupported Media Type' error (`415`).

---

### Get a Player Based on ID

Unique IDs are randomly generated by the server. You can retrieve a player using its ID:

    curl localhost:8080/v1/players/<player_id>

---

### Get a Random Player

Retrieve a random player by running:

    curl localhost:8080/v1/players/random -L  

NOTE: `-L` makes sure redirects are followed.

---

### Access the 'Admin Portal'

The `/admin` path needs basic authentication in order to return an admin portal:

    curl localhost:8080/v1/admin -u admin:<your_secret>

This secret needs to match the env variable you started the server with. If you place the wrong secret or omitted the auth header, you will be returned a `401`.

---

## Viewing Swagger Docs
You are able to view and test out the api in localhost using the Swagger UI docs in the `docs` folder:

Make sure the server is running on local, and that you are in the API server repo directory. Pull the Swagger UI image to your local machine:

    docker pull swaggerapi/swagger-ui

You should then be able to start the container on port 80 by running:

     docker run -p 80:8080 -e SWAGGER_JSON=/tmp/swagger.json -e BASE_URL=/swagger -v `pwd`/docs:/tmp swaggerapi/swagger-ui

Navigate to the Swagger UI in your browser:

    http://localhost/swagger/

TODO: Sort out CORS for postPlayer.

---
